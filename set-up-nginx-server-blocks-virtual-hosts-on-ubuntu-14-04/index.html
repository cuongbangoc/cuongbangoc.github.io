
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04</title>

  <meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1">



<link rel="apple-touch-icon" sizes="57x57" href="../assets/img/apple-touch-icon-57x57.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="60x60" href="../assets/img/apple-touch-icon-60x60.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="72x72" href="../assets/img/apple-touch-icon-72x72.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-touch-icon-76x76.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="114x114" href="../assets/img/apple-touch-icon-114x114.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="120x120" href="../assets/img/apple-touch-icon-120x120.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="144x144" href="../assets/img/apple-touch-icon-144x144.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="152x152" href="../assets/img/apple-touch-icon-152x152.png?v=wAAv6Wqe6l">
<link rel="apple-touch-icon" sizes="180x180" href="../assets/img/apple-touch-icon-180x180.png?v=wAAv6Wqe6l">
<link rel="icon" type="image/png" href="../assets/img/favicon-32x32.png?v=wAAv6Wqe6l" sizes="32x32">
<link rel="icon" type="image/png" href="../assets/img/favicon-194x194.png?v=wAAv6Wqe6l" sizes="194x194">
<link rel="icon" type="image/png" href="../assets/img/favicon-96x96.png?v=wAAv6Wqe6l" sizes="96x96">
<link rel="icon" type="image/png" href="../assets/img/android-chrome-192x192.png?v=wAAv6Wqe6l" sizes="192x192">
<link rel="icon" type="image/png" href="../assets/img/favicon-16x16.png?v=wAAv6Wqe6l" sizes="16x16">
<link rel="manifest" href="../assets/img/manifest.json?v=wAAv6Wqe6l">
<link rel="shortcut icon" href="../assets/img/favicon.ico?v=wAAv6Wqe6l">
<meta name="msapplication-TileColor" content="#e74c3c">
<meta name="msapplication-TileImage" content="/assets/img/mstile-144x144.png?v=wAAv6Wqe6l">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml?v=wAAv6Wqe6l">
<meta name="theme-color" content="#e74c3c">

  <link rel="stylesheet" type="text/css" href="../assets/css/uno.css?v=03eef1cd6d">

  <link rel="canonical" href="http://cuongbangoc.github.io/set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04/">
    
    <meta property="og:site_name" content="CuongBN - Just Do It">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04">
    <meta property="og:description" content="Introduction When using the Nginx web server, server blocks (similar to the virtual hosts in Apache) can be used to encapsulate configuration details and host more than one domain off of a single server. In this guide, I will show...">
    <meta property="og:url" content="http://cuongbangoc.github.io/set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04/">
    <meta property="article:published_time" content="2015-02-24T00:33:53.000Z">
    <meta property="article:modified_time" content="2015-08-30T11:53:58.542Z">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Nginx">
    <meta property="article:tag" content="Server block">
    <meta property="article:tag" content="Virtual host">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04">
    <meta name="twitter:description" content="Introduction When using the Nginx web server, server blocks (similar to the virtual hosts in Apache) can be used to encapsulate configuration details and host more than one domain off of a single server. In this guide, I will show...">
    <meta name="twitter:url" content="http://cuongbangoc.github.io/set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "CuongBN - Just Do It",
    "author": {
        "@type": "Person",
        "name": "Cuong Ba Ngoc",
        "image": "//www.gravatar.com/avatar/6d6e584a65d5852e400df206334e72b1?s=250&d=mm&r=x",
        "url": "http://cuongbangoc.github.io/author/cuongbangoc",
        "sameAs": null,
        "description": null
    },
    "headline": "Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04",
    "url": "http://cuongbangoc.github.io/set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04/",
    "datePublished": "2015-02-24T00:33:53.000Z",
    "dateModified": "2015-08-30T11:53:58.542Z",
    "keywords": "Linux, Nginx, Server block, Virtual host",
    "description": "Introduction When using the Nginx web server, server blocks (similar to the virtual hosts in Apache) can be used to encapsulate configuration details and host more than one domain off of a single server. In this guide, I will show..."
}
    </script>

    <meta name="generator" content="Ghost 0.6">
    <link rel="alternate" type="application/rss+xml" title="CuongBN - Just Do It" href="http://cuongbangoc.github.io/rss/">
    <script>
var profile_title = 'Cuong Ba Ngoc';
var profile_resume ='Software Engineer';
</script>

</head>
<body class="post-template tag-linux tag-nginx tag-server-block tag-virtual-host">

  <section id="menu-button" class="expanded">
    <a href="index.html"><i class="icon icon-list"></i></a>
  </section>

  <aside class="cover">

  <div class="cover container">
    <div class="profile">
      <a id="avatar-link" title="link to homepage for CuongBN - Just Do It" href="http://cuongbangoc.github.io/#open">
        <img src="../content/images/2015/08/avatar.jpg" alt="CuongBN - Just Do It avatar" class="profile avatar rounded hvr-buzz-out">
        <h1 id="profile-title">CuongBN - Just Do It</h1>
        <h3 id="profile-resume"></h3>
      </a>

      <hr class="divider long">
      <p>Software Engineer, I'm a man passionate about programming languages, new technologies and open-sources...</p>
      <hr class="divider short">
      <div class="navigation">
        <div class="profile contact">
          <nav class="navigation left">
  <ul class="links">
    <li class="links item">
      <a href="index.html" class="link-item" title="Home" id="home-button"> Home </a>
      <a href="../index.html#open" class="link-item" title="CuongBN - Just Do It blog" id="blog-button">Blog</a>
        <a href="../about/" class="link-item" id="-button">About</a>
    </li>
  </ul>
</nav>
          
<nav class="navigation right">
  <ul class="social expanded">

  <!-- Twitter -->
  <!--<li class="social item hvr-grow-rotate">
    <a target="blank" href="http://twitter.com/kikobeats" title="@Kikobeats on Twitter">
      <i class='icon icon-social-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li> -->

  <!-- Linkedin -->
  <li class="social item hvr-grow-rotate">
    <a target="blank" href="http://linkedin.com/in/cuongbangoc" title="CuongBaNgoc on LinkedIn">
      <i class="icon icon-social-linkedin"></i>
      <span class="label">Linkedin</span>
    </a>
  </li>

  <!-- Github -->
  <li class="social item hvr-grow-rotate">
    <a target="blank" href="https://github.com/cuongbangoc" title="CuongBaNgoc on Github">
      <i class="icon icon-social-github"></i>
      <span class="label">Github</span>
    </a>
  </li>

  <!-- Facebook -->
    <li class="social item hvr-grow-rotate">
      <a target="blank" href="http://facebook.com/ngoccuongkaka" title="CuongBaNgoc on Facebook">
        <i class="icon icon-social-facebook"></i>
        <span class="label">Facebook</span>
      </a>
    </li>

  <!-- RSS -->
  <li class="social item hvr-grow-rotate">
    <a href="../rss/index.rss" title="Subscribe to RSS">
      <i class="icon icon-rss"></i>
      <span class="label">RSS</span>
    </a>
  </li>

  </ul>
</nav>
          <section class="icon icon-search" id="search-container">
  <hr class="divider short">
  <form id="search-form">
    <input type="text" name="search" placeholder="git, css, javascript,..." id="search-field">
  </form>
</section>
        </div>
      </div>
    </div>
  </div>
</aside>

  <main>
    <section id="search-results"></section>
    <section class="content">
      

  <article class="post tag-linux tag-nginx tag-server-block tag-virtual-host">
    <header>
      <div class="post meta">
        <time datetime="24 Feb 2015">24 Feb 2015</time>
        <span class="post tags">in <a href="../tag/linux/">Linux</a> <a href="../tag/nginx/">Nginx</a> <a href="../tag/server-block/">Server block</a> <a href="../tag/virtual-host/">Virtual host</a></span>


        <span class="post reading-time"> ~ <span></span> read.</span>
      </div>

      <a alt="Tweet 'Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04'" href="https://twitter.com/intent/tweet?text=Set%20Up%20Nginx%20Server%20Blocks%20(Virtual%20Hosts)%20on%20Ubuntu%2014.04%20%20%C2%BB%20&amp;url=http://cuongbangoc.github.io/set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04/">
        
        <h1 class="icon-reverse icon-social-twitter-post" id="post-title">Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 14.04</h1>
      </a>
    </header>

    <div id="post-content" class="post tag-linux tag-nginx tag-server-block tag-virtual-host">
      <h3 id="introduction">Introduction</h3>

<p>When using the Nginx web server, <code>server blocks</code> (similar to the virtual hosts in Apache) can be used to encapsulate configuration details and host more than one domain off of a single server.</p>

<p>In this guide, I will show configure server blocks in Nginx Web Server on an Ubuntu 14.04 server.</p>

<h3 id="steponechangedocumentrootdirectories">Step one – Change Document Root Directories</h3>

<p>By default, Nginx on Ubuntu 14.04 has one server block enabled by default. It is configured to serve documents out of a directory at:</p>

<pre><code class="language-prettyprint lang-bash">/usr/share/nginx/html
</code></pre>

<p>I won’t use the default since it is easier to work with things in the <code>/var/www</code> directory. So I will change document root directory to /var/www.</p>

<p>First, we need to create the necessary directories. We can do this with the following command. The <code>-p </code>flag tells <code>mkdir</code> to create any necessary parent directories along the way:</p>

<pre><code class="language-prettyprint lang-bash">sudo mkdir -p /var/www/test.com/html  
</code></pre>

<p>Now that you have your directories created, we need to transfer ownership to our regular user. We can use the <code>$USER</code> environmental variable to substitute the user account that we are currently signed in on. This will allow us to create files in this directory without allowing our visitors to create content.</p>

<pre><code class="language-prettyprint lang-bash">sudo chown -R $USER:$USER /var/www/test.com/html  
</code></pre>

<p>The permissions of our web roots should be correct already if you have not modified your <code>umask</code> value, but we can make sure by typing:</p>

<pre><code class="language-prettyprint lang-bash">sudo chmod -R 755 /var/www  
</code></pre>

<p>Our directory structure is now configured and we can move on.</p>

<h3 id="steptwocreatetestpage">Step two – Create test page</h3>

<p>Now that we have our directory structure set up, let’s create a default page for our sites so that we will have something to display.</p>

<p>Create an <code>index.html</code> file in your domain:</p>

<pre><code class="language-prettyprint lang-bash">vim /var/www/test.com/html/index.html  
</code></pre>

<p>Inside the file, we’ll create a really basic file that indicates what site we are currently accessing. It will look like this:</p>

<pre><code class="language-prettyprint lang-bash">  &lt;title&gt;Welcome to Test.com!&lt;/title&gt;   
  &lt;h1&gt;Success! The test.com server block is working&lt;/h1&gt;  
</code></pre>

<p>Save and close the file when you are finished. Now, you have a test page.</p>

<h3 id="stepthreecreateserverblock">Step three – Create server block</h3>

<p>By default, Nginx contains one server block called <code>default</code> which we can use as a template for our own configurations. We will begin by designing our server block and make the necessary modifications.</p>

<p>As mentioned above, we will create our server block config file by copying over the default file:</p>

<pre><code class="language-prettyprint lang-bash">cd /etc/nginx/sites-available  
sudo cp default test.com  
</code></pre>

<p>Now, open the new file you created in your text editor with root privileges:</p>

<pre><code class="language-prettyprint lang-bash">sudo vim /etc/nginx/sites-available/test.com  
</code></pre>

<p>Ignoring the commented lines, the file will look similar to this:</p>

<pre><code class="language-prettyprint lang-bash">server {  
    listen 80 default_server; 
    listen [::]:80 default_server ipv6only=on; 
    root /usr/share/nginx/html; 
    index index.html index.htm; 
    server_name localhost; 
    location / { 
        try_files $uri $uri/ =404; 
    } 
}
</code></pre>

<p>We are eventually going to disable the default server block configuration, so we can place the <code>default_server</code> option in either this server block or in the one for our other site. I’m going to leave the <code>default_server</code> option enabled in this server block, but you can choose whichever is best for your situation.</p>

<p>The next thing we’re going to have to adjust is the document root, specified by the <code>root</code> directive. Point it to the site’s document root that you created:</p>

<pre><code class="language-prettyprint lang-bash">root /var/www/test.com/html;  
</code></pre>

<p><strong>Note</strong>: Each Nginx statement <em>must</em> end with a semi-colon (;), so check each of your lines if you are running into problems.</p>

<p>Next, we want to modify the <code>server_name</code> to match requests for our first domain. We can additionally add any aliases that we want to match. We will add a <code>www.test.com</code> alias to demonstrate:</p>

<pre><code class="language-prettyprint lang-bash">server_name test.com www.test.com;  
</code></pre>

<p>When you are finished, your file will look something like this:</p>

<pre><code class="language-prettyprint lang-bash">server {  
    listen 80 default_server; 
    listen [::]:80 default_server ipv6only=on; 
    root /var/www/test.com/html; 
    index index.html index.htm; 
    server_name test.com www.test.com; 
    location / { 
        try_files $uri $uri/ =404; 
    } 
}
</code></pre>

<p>That is all we need for a basic configuration. Save and close the file to exit.</p>

<h3 id="stepfourenableyourserverblock">Step four – Enable your server block</h3>

<p>We can do this by creating symbolic links from these files to the <code>sites-enabled</code> directory, which Nginx reads from during startup.</p>

<p>We can create these links by typing:</p>

<pre><code class="language-prettyprint lang-bash">sudo ln -s /etc/nginx/sites-available/test.com /etc/nginx/sites-enabled/  
</code></pre>

<p>This file are now in the enabled directory. However, the default server block file we used as a template is also enabled currently and will conflict with our file that has the <code>default_server</code> parameter set.</p>

<p>We can disable the default server block file by simply removing the symbolic link. It will still be available for reference in the <code>sites-available</code> directory, but it won’t be read by Nginx on startup:</p>

<pre><code class="language-prettyprint lang-bash">sudo rm /etc/nginx/sites-enabled/default  
</code></pre>

<p>We also need to edit one setting really quickly in the default Nginx configuration file. Open it up by typing:</p>

<pre><code class="language-prettyprint lang-bash">sudo vim /etc/nginx/nginx.conf  
</code></pre>

<p>We just need to uncomment one line. Find and remove the comment from this:</p>

<pre><code class="language-prettyprint lang-bash">server_names_hash_bucket_size 64;  
</code></pre>

<p>Now, we are ready to restart Nginx to enable your changes. You can do that by typing:</p>

<pre><code class="language-prettyprint lang-bash">sudo service nginx restart  
</code></pre>

<p>Nginx should now be serving your domain name.</p>

<h3 id="stepfivesetuplocalhostsfile">Step five – Setup Local hosts file</h3>

<p>You can edit hosts file by typing:</p>

<pre><code class="language-prettyprint lang-bash">sudo vim /etc/hosts  
</code></pre>

<p>You need to add your domain local:</p>

<pre><code class="language-prettyprint lang-bash">127.0.0.1 localhost  
127.0.0.1 guest-desktop  
127.0.0.1 test.com  
</code></pre>

<p>This will intercept any requests for <code>test.com</code> and send them to your server, which is what we want if we don’t actually own the domains that we are using.</p>

<p>Save and close the file when you are finished.</p>

<h3 id="stepsixtest">Step six – Test</h3>

<p>Now that you are all set up, you should test that your server blocks are functioning correctly. You can do that by visiting the domains in your web browser:</p>

<pre><code class="language-prettyprint lang-bash">http://test.com  
</code></pre>

<p>You should see a page with message "Success".</p>
    </div>

    <div class="post related">
        <a rel="prev" id="prev-btn" class="btn small square" href="../how-to-install-linux-nginx-mysql-php-lemp-on-ubuntu-14-04/">← How To Install Linux, Nginx, MySQL, PHP (LEMP) On Ubuntu 14.04</a>

        <a rel="next" id="next-btn" class="btn small square" href="../set-up-master-slave-replication-in-mysql/">Set Up Master-Slave Replication in MySQL →</a>
    </div>

    <footer class="post comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + window.disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</footer>

  </article>


      <footer>
  <span class="copyright">
   <a href="http://cuongbangoc.github.io" style="font-weight: bold;">CuongBa Blog</a> © 2015. All rights reserved. Built with <a href="https://ghost.org/" target="_blank">Ghost</a> and <a href="https://github.com/Kikobeats/uno-zen" target="_blank">Uno Zen</a> theme.
  </span>
</footer>
    </section>
  </main>

  <script src="../public/jquery.js?v=03eef1cd6d"></script>
  <script type="text/javascript" src="../assets/js/run_prettify.js?v=03eef1cd6d"></script>
  <script type="text/javascript" src="../assets/js/uno.js?v=03eef1cd6d"></script>
  <script>
  if (window.ga_id) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', window.ga_id, 'auto');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');
  }
</script>
</body>
